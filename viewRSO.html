<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>View All Registered Student Organizations</title>
</head>
<body>
    <center>
        <h2>View All Registered Student Organizations</h2>
    </center>

    <!-- New nav bar settings -->
    <div class="navbar">
        <center>
            <button id="homeBtn" type="button" onclick="document.location='home.html'">Home</button>
            <button id="logoutBtn" type="button" onclick="document.location='index.html'">Log out</button>
            <button id="createEventBtn" type="button" onclick="document.location='createEvent.html'">Create New Event</button>
            <button id="registerRSOBtn" type="button" onclick="document.location='createRSO.html'">Register New Organization</button>
            <button id="createUniversityBtn" type="button" onclick="document.location='createUniversity.html'">Create University</button>
            <button id="viewRSOBtn" type="button" onclick="document.location='viewRSO.html'">View RSO</button>
        </center>
    </div>

    <table id="rsoTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="rsoTableBody">
            <!-- Table rows will be dynamically added here -->
        </tbody>
    </table>

    <script>
        // Function to join an RSO
        function joinRSO(rso_id) {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var response = JSON.parse(this.responseText);
                    if (response.success) {
                        alert("Successfully joined RSO.");
                        // Optionally, you can update the UI to reflect the change after joining the RSO
                    } else {
                        alert("Error joining RSO: " + response.message);
                    }
                }
            };
            xhttp.open("GET", "joinRSO.php?rso_id=" + rso_id, true);
            xhttp.send();
        }

        // Function to fetch RSOs from the server
        function fetchRSOs() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    // Parse the JSON response
                    var rsos = JSON.parse(this.responseText);
                    // Populate the RSO table with the fetched data
                    populateRSOs(rsos);
                }
            };
            xhttp.open("GET", "fetchRSO.php", true);
            xhttp.send();
        }

        // Function to populate RSO table
        function populateRSOs(rsos) {
            var rsoTableBody = document.getElementById("rsoTableBody");
            rsoTableBody.innerHTML = ""; // Clear existing rows
            rsos.forEach(function(rso) {
                var row = rsoTableBody.insertRow();
                var nameCell = row.insertCell(0);
                var descriptionCell = row.insertCell(1);
                var actionCell = row.insertCell(2); // New cell for action
                nameCell.textContent = rso.name;
                descriptionCell.textContent = rso.rso_description;
                var joinButton = document.createElement("button"); // Create a button
                joinButton.textContent = "Join"; // Set button text
                joinButton.onclick = function() {
                    joinRSO(rso.rso_id); // Call joinRSO function with rso_id
                };
                actionCell.appendChild(joinButton); // Add button to cell
            });
        }

        // Call fetchRSOs function when the page loads
        window.onload = function() {
            fetchRSOs();
        };
    </script>
</body>
</html>
