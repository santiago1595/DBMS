<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Home</title>
</head>
<body>
    <center>
        <h2>Home</h2>
    </center>

    <!-- New nav bar settings -->
    <div class="navbar">
        <center>
            <button id="homeBtn" type="button" onclick="document.location='home.html'">Home</button>
            <button id="logoutBtn" type="button" onclick="document.location='index.html'">Log out</button>
            <button id="createEventBtn" type="button" onclick="document.location='createEvent.html'">Create New Event</button>
            <button id="registerRSOBtn" type="button" onclick="document.location='createRSO.html'">Register New Organization</button>
            <button id="createUniversityBtn" type="button" onclick="document.location='createUniversity.html'">Create University</button>
            <button id="viewRSOBtn" type="button" onclick="document.location='viewRSO.html'">View RSO</button>
        </center>
    </div>
    <script>
        const role = "student"; // Assuming the user is a student
        const navbarBtns = document.querySelectorAll('.navbar button');
    
        if (role === "student") {
            navbarBtns.forEach(btn => {
                if (btn.id !== "homeBtn" && btn.id !== "logoutBtn" && btn.id !== "viewRSOBtn") {
                    btn.style.display = "none";
                }
            });
        } else if (role === "admin") {
            navbarBtns.forEach(btn => {
                btn.style.display = "vertical";
            });
        } else if (role === "superadmin") {
            navbarBtns.forEach(btn => {
                btn.style.display = "vertical";
            });
        }
    </script>
    
    <!-- Table for the events -->
    <center>
        <h3>Current Events</h3>
    </center>
    <table id="eventsTable">
        <thead>
            <tr>
                <th>Event Name</th>
                <th>Date</th>
                <th>Description</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="eventsTableBody">
            <!-- Table rows will be dynamically added here -->
        </tbody>
    </table>

    <script>
// Function to join an event
function joinEvent(event_id) {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            var response = JSON.parse(this.responseText);
            if (response.success) {
                alert("Successfully joined event.");
                // Optionally, you can update the UI to reflect the change after joining the event
            } else {
                alert("Error joining event: " + response.message);
            }
        }
    };
    xhttp.open("GET", "joinEvent.php?event_id=" + event_id, true);
    xhttp.send();
}

// Function to fetch events from the server
function fetchEvents() {
    var xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            // Parse the JSON response
            var events = JSON.parse(this.responseText);
            // Populate the events table with the fetched data
            populateEvents(events);
        }
    };
    xhttp.open("GET", "fetchEvents.php", true);
    xhttp.send();
}

// Function to populate events table
function populateEvents(events) {
    var eventsTableBody = document.getElementById("eventsTableBody");
    eventsTableBody.innerHTML = ""; // Clear existing rows
    events.forEach(function(event) {
        var row = eventsTableBody.insertRow();
        var nameCell = row.insertCell(0);
        var dateCell = row.insertCell(1);
        var descriptionCell = row.insertCell(2);
        var actionCell = row.insertCell(3); // New cell for action
        nameCell.textContent = event.name;
        dateCell.textContent = event.date;
        descriptionCell.textContent = event.description;
        var joinButton = document.createElement("button"); // Create a button
        joinButton.textContent = "Join"; // Set button text
        joinButton.onclick = function() {
            joinEvent(event.event_id); // Call joinEvent function with event_id
        };
        actionCell.appendChild(joinButton); // Add button to cell
    });
}
    
        // Function to add join buttons to event rows
        function addJoinButtons() {
            var eventRows = document.querySelectorAll("#eventsTableBody tr");
            eventRows.forEach(function(row) {
                var actionsCell = row.insertCell(-1); // Insert cell for actions at the end
                var joinButton = document.createElement("button"); // Create a button for joining
                joinButton.textContent = "Join"; // Set button text
                joinButton.onclick = function() { joinEvent(row.event_id); }; // Define button action
                actionsCell.appendChild(joinButton); // Add join button to cell
            });
        }
    
        // Function to add a comment for an event
        function addComment(eventName) {
            var comment = prompt("Enter your comment for " + eventName + ":");
            if (comment) {
                // Implement add comment functionality here
                alert("Comment added: " + comment);
            }
        }
    
        // Function to delete a comment for an event
        function deleteComment(eventName) {
            var commentToDelete = prompt("Enter the comment you want to delete for " + eventName + ":");
            if (commentToDelete) {
                // Implement delete comment functionality here
                alert("Comment deleted: " + commentToDelete);
            }
        }
    
        // Call fetchEvents function when the page loads
        window.onload = function() {
            fetchEvents();
        };
    </script>
</body>
</html>
